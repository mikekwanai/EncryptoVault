# EncryptoVault

Private document collaboration on public chains using Zama FHEVM. Create, share, and update encrypted documents with
on-chain access control and client-side encryption.

## Overview

EncryptoVault is a privacy-first document workflow that combines Fully Homomorphic Encryption (FHE) for key exchange
with client-side symmetric encryption for document content. Users generate a short numeric secret, encrypt it with Zama
FHE, store it on-chain, and use it to encrypt/decrypt document bodies locally. Authorized collaborators can decrypt the
same secret and submit updates without ever exposing the plaintext on-chain.

This repository includes:
- Solidity contracts for encrypted document metadata, access control, and updates.
- Hardhat deployment, tasks, and tests.
- A React + Vite frontend that reads with viem and writes with ethers.

## Problems Solved

- **Private collaboration on public chains**: keep document contents confidential while preserving on-chain integrity.
- **Controlled sharing**: document owners explicitly grant access to collaborators without revealing the secret key
  publicly.
- **On-chain state consistency**: document updates are stored and verified on-chain, enabling verifiable changes without
  leaking plaintext.
- **Minimal trust**: no centralized server is required to manage keys or content.

## Key Advantages

- **FHE-protected key exchange**: the document secret is stored as ciphertext on-chain and is decrypted only by
  authorized users.
- **Client-side encryption**: document content is encrypted locally using the secret before submission.
- **Permissioned editing**: owners can allow other addresses to decrypt the secret and submit changes.
- **Auditability at the transaction level**: every update is a transaction, enabling transparent change provenance while
  preserving content privacy.
- **Full-stack reference implementation**: contracts, tasks, tests, and UI are integrated in one repo.

## Core User Flows

1. **Create document**
   - Generate a random 9-digit secret `A` locally.
   - Encrypt `A` using Zama FHE and submit the document name, empty body, and encrypted `A` on-chain.

2. **Decrypt and edit**
   - Fetch the document name and encrypted `A` from the chain.
   - Decrypt `A` in the client, edit the document, and encrypt the body using `A`.
   - Submit the encrypted body back on-chain.

3. **Share access**
   - Grant `allow A` to another address.
   - The collaborator decrypts `A` and can submit edits using the same encryption flow.

## Tech Stack

- **Smart contracts**: Solidity, Hardhat, Zama FHEVM
- **Frontend**: React, Vite
- **Wallet + chain**: Rainbow (wallet UI)
- **Chain read**: viem
- **Chain write**: ethers
- **Package manager**: npm

## Architecture Notes

- **Contracts** live in `contracts/` and implement document storage, access control, and encrypted secret handling.
- **Deployment scripts** live in `deploy/` and use a private key with `dotenv`.
- **Tasks** live in `tasks/` and support scripted workflows.
- **Frontend** lives in `frontend/` and embeds the ABI generated by the contracts.
- **ABI source of truth** is `deployments/sepolia` and is copied into the frontend code (no JSON files in the frontend).

## Repository Layout

```
EncryptoVault/
├── contracts/          # Smart contracts
├── deploy/             # Deployment scripts
├── deployments/        # Deployment artifacts and ABI
├── tasks/              # Hardhat tasks
├── test/               # Hardhat tests
├── frontend/           # React + Vite app
├── docs/               # Zama references
└── hardhat.config.ts   # Hardhat configuration
```

## Setup

### Prerequisites

- **Node.js**: 20+
- **npm**: 9+

### Install

```bash
npm install
```

### Environment (deployment only)

Create a `.env` file at the repo root with the following keys:

```
INFURA_API_KEY=your_infura_key
PRIVATE_KEY=your_private_key
```

Notes:
- Deployment uses `dotenv` with `process.env.INFURA_API_KEY` and `process.env.PRIVATE_KEY`.
- Do not use a mnemonic for deployment.
- The frontend does not read environment variables.

### Compile and Test

```bash
npm run compile
npm run test
```

### Local Contract Development

```bash
npx hardhat node
npx hardhat deploy --network localhost
```

### Deploy to Sepolia

```bash
npx hardhat deploy --network sepolia
```

### Frontend

The frontend uses the Sepolia deployment artifacts and connects to Sepolia only (no localhost network). Ensure the ABI in
`deployments/sepolia` is copied into the frontend before running the UI.

```bash
cd frontend
npm install
npm run dev
```

## Security and Privacy Notes

- **Document names are public**: names and on-chain metadata are visible to all; only contents and secrets are encrypted.
- **Secret handling is local**: the 9-digit secret is generated and decrypted client-side.
- **Access control is explicit**: only addresses granted `allow A` can decrypt and edit.
- **Key disclosure risk**: sharing the secret outside the intended flow bypasses the on-chain access model.
- **Gas costs apply**: encryption-related operations and updates are on-chain transactions.

## Limitations

- Document names are not encrypted.
- There is no full-text search over encrypted content.
- Content size is limited by on-chain storage constraints.
- Usability depends on the user's wallet and client environment.

## Future Roadmap

- Encrypted document metadata (optional private titles and tags).
- Revision history with diff-friendly storage for large documents.
- Off-chain storage with on-chain integrity proofs for bigger files.
- More granular permissions (read-only, edit, revoke, time-limited access).
- Multi-device key recovery workflows.
- Improved UI/UX and accessibility across devices.
- Additional network support once FHEVM deployments mature.

## References

- Zama FHEVM guidance: `docs/zama_llm.md`
- Frontend relayer guidance: `docs/zama_doc_relayer.md`

## License

BSD-3-Clause-Clear. See `LICENSE`.
